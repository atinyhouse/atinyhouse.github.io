# 📱 获取即刻动态完整指南

## 方法一：浏览器控制台复制（最简单推荐）⭐️

这个方法不需要安装任何东西，直接在浏览器操作即可。

### 第一步：打开即刻主页

在浏览器（Chrome/Edge/Safari）中访问：
```
https://web.okjike.com/u/71A6B3C3-1382-4121-A17A-2A4C05CB55E8
```

**重要**：确保你已经登录即刻账号！

---

### 第二步：打开开发者工具

#### 如果你用的是 Mac：
- 按快捷键：`Command ⌘ + Option ⌥ + I`
- 或者按 `F12`

#### 如果你用的是 Windows：
- 按快捷键：`Ctrl + Shift + I`
- 或者按 `F12`

**应该出现：** 浏览器底部或右侧会出现一个开发者工具面板

---

### 第三步：切换到 Console（控制台）标签

在开发者工具的顶部，找到并点击 **Console** 标签

---

### 第四步：滚动加载更多动态（可选）

在即刻页面向下滚动，加载更多历史动态。建议加载到你想要展示的所有动态为止。

---

### 第五步：复制代码并执行

**复制下面的完整代码**（从第一行到最后一行）：

```javascript
// ===== 即刻动态提取脚本 - 开始 =====
(function() {
    console.log('🚀 开始提取即刻动态...');

    const posts = [];

    // 尝试多种可能的选择器
    const selectors = [
        '[class*="FeedItem"]',
        '[class*="feed-item"]',
        'article',
        '[data-type="ORIGINAL_POST"]'
    ];

    let postElements = null;
    for (const selector of selectors) {
        postElements = document.querySelectorAll(selector);
        if (postElements.length > 0) {
            console.log(`✅ 使用选择器: ${selector}, 找到 ${postElements.length} 个元素`);
            break;
        }
    }

    if (!postElements || postElements.length === 0) {
        alert('❌ 未找到动态内容！\n\n可能原因：\n1. 页面未加载完成\n2. 未登录即刻账号\n3. 网页结构已更新\n\n请刷新页面重试');
        return;
    }

    // 提取动态数据
    postElements.forEach((el, idx) => {
        if (idx > 50) return; // 最多提取50条

        const post = {};

        // 提取日期时间
        const timeEl = el.querySelector('time') ||
                       el.querySelector('[class*="time"]') ||
                       el.querySelector('[class*="date"]');

        if (timeEl) {
            const datetime = timeEl.getAttribute('datetime') || timeEl.textContent;
            try {
                const date = new Date(datetime);
                if (!isNaN(date.getTime())) {
                    post.date = date.toISOString().split('T')[0];
                    post.time = date.toTimeString().substring(0, 5);
                }
            } catch(e) {
                console.warn('时间解析失败', datetime);
            }
        }

        // 提取内容文本
        const contentEl = el.querySelector('[class*="content"]') ||
                          el.querySelector('[class*="RichContent"]') ||
                          el.querySelector('p');

        if (contentEl) {
            let text = contentEl.innerText || contentEl.textContent;
            text = text.trim();

            // 清理多余空白
            text = text.replace(/\n{3,}/g, '\n\n');
            text = text.replace(/[ \t]+/g, ' ');

            // 限制长度
            if (text.length > 1000) {
                text = text.substring(0, 1000) + '...';
            }

            if (text) {
                post.content = text;
            }
        }

        // 提取图片
        const imgs = el.querySelectorAll('img');
        const imageUrls = [];

        imgs.forEach(img => {
            const src = img.src || img.getAttribute('data-src');
            // 过滤掉头像和小图标
            if (src &&
                !src.includes('avatar') &&
                !src.includes('icon') &&
                src.includes('jike')) {
                imageUrls.push(src);
            }
        });

        if (imageUrls.length > 0) {
            post.images = imageUrls.slice(0, 9); // 最多9张图
        }

        // 提取链接
        const links = el.querySelectorAll('a[href^="http"]');
        links.forEach(link => {
            const href = link.href;
            // 排除即刻自己的链接
            if (!href.includes('okjike.com') &&
                !href.includes('ruguoapp.com')) {
                post.link = href;
                post.link_title = link.textContent.trim() || '查看链接';
            }
        });

        // 只保存有效的动态
        if (post.content || post.images) {
            posts.push(post);
        }
    });

    if (posts.length === 0) {
        alert('❌ 没有提取到有效内容！\n\n请确认：\n1. 页面是否显示了你的动态\n2. 是否已登录');
        return;
    }

    console.log(`✅ 成功提取 ${posts.length} 条动态`);

    // 生成 YAML 格式
    let yaml = '# ============================================\n';
    yaml += '# Thoughts 数据文件 - 即刻动态（自动生成）\n';
    yaml += '# ============================================\n';
    yaml += '#\n';
    yaml += `# 提取时间: ${new Date().toLocaleString('zh-CN')}\n`;
    yaml += `# 动态数量: ${posts.length} 条\n`;
    yaml += '#\n';
    yaml += '# ============================================\n\n';

    posts.forEach(post => {
        yaml += `- date: ${post.date || '2025-01-01'}\n`;

        if (post.time) {
            yaml += `  time: "${post.time}"\n`;
        }

        if (post.content) {
            // 处理多行内容
            const lines = post.content.split('\n');
            if (lines.length > 1 || post.content.includes(':')) {
                yaml += '  content: |\n';
                lines.forEach(line => {
                    yaml += `    ${line}\n`;
                });
            } else {
                // 单行内容需要处理特殊字符
                const escaped = post.content
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"');
                yaml += `  content: "${escaped}"\n`;
            }
        }

        if (post.images && post.images.length > 0) {
            yaml += '  images:\n';
            post.images.forEach(img => {
                yaml += `    - ${img}\n`;
            });
        }

        if (post.link) {
            yaml += `  link: ${post.link}\n`;
            const escapedTitle = (post.link_title || '查看链接')
                .replace(/\\/g, '\\\\')
                .replace(/"/g, '\\"');
            yaml += `  link_title: "${escapedTitle}"\n`;
        }

        yaml += '\n';
    });

    // 下载文件
    const blob = new Blob([yaml], { type: 'text/yaml;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'thoughts.yml';
    a.click();
    URL.revokeObjectURL(url);

    // 显示结果
    console.log('📄 YAML 内容预览：');
    console.log(yaml.substring(0, 500) + '...');

    alert(`✅ 成功提取 ${posts.length} 条动态！\n\n文件已自动下载为：thoughts.yml\n\n请将此文件替换到：\n_data/thoughts.yml`);
})();
// ===== 即刻动态提取脚本 - 结束 =====
```

**操作：**
1. 全选上面的代码（Command+A 或 Ctrl+A）
2. 复制（Command+C 或 Ctrl+C）
3. 在 Console 控制台中粘贴（Command+V 或 Ctrl+V）
4. 按回车键执行

---

### 第六步：等待下载

脚本执行后会：
- 在控制台显示提取进度
- 自动下载 `thoughts.yml` 文件
- 弹出成功提示

**下载位置：** 通常在你的"下载"文件夹

---

### 第七步：替换文件

找到下载的 `thoughts.yml` 文件，将它复制到：
```
/Users/didi/Desktop/b/atinyhouse.github.io/_data/thoughts.yml
```

**直接替换**原来的文件即可！

---

### 第八步：验证数据

用文本编辑器打开 `thoughts.yml`，应该看到类似这样的内容：

```yaml
# ============================================
# Thoughts 数据文件 - 即刻动态（自动生成）
# ============================================

- date: 2025-01-20
  time: "14:30"
  content: |
    这是一条即刻动态的内容

    可以有多行

- date: 2025-01-19
  content: "另一条动态"
  images:
    - https://example.com/image.jpg
```

---

## 方法二：使用浏览器书签按钮

### 步骤 1：打开书签工具页面

在终端执行：
```bash
open /Users/didi/Desktop/b/atinyhouse.github.io/scripts/jike_bookmarklet.html
```

或者直接在 Finder 中打开该 HTML 文件。

### 步骤 2：添加书签

看到页面上有一个紫色按钮"🚀 抓取即刻动态"，**拖拽**这个按钮到浏览器的书签栏。

### 步骤 3：访问即刻主页

在浏览器中打开你的即刻主页。

### 步骤 4：点击书签

点击刚才添加的书签按钮，会自动下载 `thoughts.yml` 文件。

---

## 方法三：使用 Python 脚本（需要技术基础）

### 前置条件

确保已安装 Python 3：
```bash
python3 --version
```

### 安装依赖

```bash
cd /Users/didi/Desktop/b/atinyhouse.github.io
pip3 install pyyaml requests
```

### 方案 3A：直接 API 获取

```bash
python3 scripts/fetch_jike.py
```

如果即刻 API 要求登录，会提示失败。

### 方案 3B：解析 JSON 数据

**步骤 1：** 在浏览器开发者工具中：
1. 按 F12 打开开发者工具
2. 切换到 **Network**（网络）标签
3. 刷新即刻主页
4. 找到包含 `userPost` 或 `loadmore` 的请求
5. 右键 → Copy → Copy Response（复制响应）

**步骤 2：** 保存为 JSON 文件：
```bash
# 创建文件
touch /Users/didi/Desktop/b/atinyhouse.github.io/jike_data.json

# 用编辑器打开，粘贴刚才复制的内容
```

**步骤 3：** 运行解析脚本：
```bash
cd /Users/didi/Desktop/b/atinyhouse.github.io
python3 scripts/parse_jike_json.py jike_data.json
```

会自动生成 `_data/thoughts.yml` 文件。

---

## 常见问题解决

### Q1: 提示"未找到动态内容"

**原因：**
- 页面未加载完成
- 未登录即刻账号
- 即刻页面结构更新

**解决：**
1. 确保已登录即刻
2. 等待页面完全加载
3. 向下滚动加载更多动态
4. 刷新页面重试

---

### Q2: 下载的文件是空的或格式错误

**解决：**
- 确保完整复制了脚本代码（从第一行到最后一行）
- 检查控制台是否有错误信息（红色文字）
- 尝试在无痕模式下重新登录即刻

---

### Q3: 图片显示不出来

**说明：** 即刻图片链接需要网络访问，本地预览时可能看不到。

**解决：** 推送到 GitHub Pages 后在线查看即可。

---

### Q4: 日期时间不对

**说明：** 脚本会尽量提取准确的时间，但如果即刻页面格式变化，可能提取失败。

**解决：** 手动编辑 `thoughts.yml` 文件修正日期。

---

## 提取成功后

### 查看数据

```bash
cat /Users/didi/Desktop/b/atinyhouse.github.io/_data/thoughts.yml
```

### 本地预览

```bash
# 先安装 Jekyll（如果还没装）
gem install jekyll bundler

# 启动本地服务器
cd /Users/didi/Desktop/b/atinyhouse.github.io
bundle install
bundle exec jekyll serve

# 浏览器访问
open http://localhost:4000/thoughts/
```

### 推送到 GitHub

```bash
cd /Users/didi/Desktop/b/atinyhouse.github.io
git add _data/thoughts.yml
git commit -m "更新即刻动态数据"
git push origin gh-pages

# 等待 1-2 分钟后访问
open https://atinyhouse.github.io/thoughts/
```

---

## 定期更新

每次想更新即刻动态时：

1. 重复「方法一」的步骤
2. 替换 `_data/thoughts.yml` 文件
3. 提交并推送到 GitHub

**建议：** 每周或每月更新一次。

---

## 需要帮助？

如果遇到问题：

1. **查看控制台错误：** 开发者工具的 Console 标签会显示错误信息
2. **检查网络：** 确保能正常访问即刻网站
3. **更新浏览器：** 使用最新版 Chrome、Edge 或 Safari
4. **清除缓存：** 尝试清除浏览器缓存后重试

---

**祝你使用愉快！ 🎉**
