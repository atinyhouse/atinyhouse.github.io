name: Sync Jike Thoughts

on:
  # å®šæ—¶è¿è¡Œï¼šæ¯å¤©åŒ—äº¬æ—¶é—´ 8:00, 14:00, 20:00ï¼ˆUTC 0:00, 6:00, 12:00ï¼‰
  schedule:
    - cron: '0 0,6,12 * * *'

  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  sync-thoughts:
    runs-on: ubuntu-latest

    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. è®¾ç½® Python ç¯å¢ƒ
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: |
          pip install PyYAML

      # 4. è¿è¡ŒåŒæ­¥è„šæœ¬
      - name: Sync Jike thoughts from RSSHub
        run: |
          python scripts/sync_jike_simple.py

      # 5. æäº¤æ›´æ”¹
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"

          # æ·»åŠ å˜æ›´æ–‡ä»¶
          git add _data/thoughts.yml

          # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
          if git diff --staged --quiet; then
            echo "âœ“ æ²¡æœ‰æ–°çš„åŠ¨æ€éœ€è¦åŒæ­¥"
            exit 0
          fi

          # æäº¤å¹¶æ¨é€
          TIMESTAMP=$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')
          git commit -m "chore: auto sync jike thoughts - ${TIMESTAMP}

ğŸ¤– é€šè¿‡ RSSHub è‡ªåŠ¨åŒæ­¥å³åˆ»åŠ¨æ€

Co-Authored-By: GitHub Actions <noreply@github.com>"
          git push

      # 6. æŠ¥å‘ŠçŠ¶æ€
      - name: Report status
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "âœ… å³åˆ»åŠ¨æ€åŒæ­¥æˆåŠŸ"
          else
            echo "âŒ å³åˆ»åŠ¨æ€åŒæ­¥å¤±è´¥"
          fi
